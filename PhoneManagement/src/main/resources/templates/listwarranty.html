<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Gentelella Alela! | Users List</title>
    <!-- Bootstrap -->
    <link th:href="@{/vendors/bootstrap/dist/css/bootstrap.min.css}" rel="stylesheet">
    <!-- Font Awesome -->
    <link th:href="@{/vendors/font-awesome/css/font-awesome.min.css}" rel="stylesheet">
    <!-- NProgress -->
    <link th:href="@{/vendors/nprogress/nprogress.css}" rel="stylesheet">
    <!-- iCheck -->
    <link th:href="@{/vendors/iCheck/skins/flat/green.css}" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link th:href="@{/build/css/custom.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        .form-inline .form-group {
            margin-left: -9px;
        }

        .pagination .page-item.active .page-link {
            background-color: #007bff; /* Change to your preferred color */
            border-color: #007bff; /* Ensure the border color matches the background if needed */
            color: white; /* Change text color for better visibility */
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    </style>

</head>

<body class="nav-md">
<div class="container body">
    <header th:insert="~{fragments/menu.html :: header}"></header>

    <div class="right_col" role="main">
        <div class="row-fluid">
            <h3>Warranty List</h3>
        </div>
        <div class="row"> <!-- New row for better alignment and separation -->
            <!--            <form th:action="@{/admin/users}" method="get" class="form-inline w-100">-->
            <!--                <div class="row">-->
            <!--                    <div class="col-md-9"> &lt;!&ndash; This column now takes up more space pushing elements to the right &ndash;&gt;-->
            <!--                    </div>-->
            <!--                    <div class="col-md-3 d-flex justify-content-end">-->
            <!--                        &lt;!&ndash; Combined Search Input and Role Filter Dropdown into a single column &ndash;&gt;-->
            <!--                        <div class="form-group">-->
            <!--                            <input type="text" class="form-control form-control-sm" th:name="query" placeholder="Search for..." style="margin-right: 10px;">-->
            <!--                            <select name="role" class="form-control form-control-sm">-->
            <!--                                <option value="">Select Role</option>-->
            <!--                                <option th:each="role : ${rolesFilter}" th:value="${role.roleId}" th:text="${role.roleName}"></option>-->
            <!--                            </select>-->
            <!--                            <button class="btn btn-secondary btn-sm" type="submit">Go</button>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->

            <!--            </form>-->
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="x_panel">
                    <div class="x_content">
                        <!-- Start Project List -->
                        <table class="table table-striped projects">
                            <thead>
                            <tr>
                                <th style="width: 20%">ProductName</th>
                                <th>Image</th>
                                <th>Issue</th>
                                <th>Customer Name</th>
                                <th>Warranty date</th>
                                <th>Status</th>
                                <th>Technical Name</th>
                                <th style="width: 20%">Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${warrantyPage == null || #lists.isEmpty(warrantyPage)}">
                                <td colspan="7">No records found</td>
                            </tr>
                            <tr th:each="technical : ${warrantyPage}">
                                <td th:text="${technical.productName}"></td>
                                <td>
                                    <img th:src="@{'/uploads/' + ${technical.image}}" alt="Product Image"
                                         style="width: 100px; height: auto;">
                                </td>
                                <td th:text="${technical.issueDescription}"></td>
                                <td th:text="${technical.user.fullName}"></td>
                                <td th:text="${#dates.format(technical.repairDate, 'yyyy-MM-dd')}"></td>
                                <td th:text="${technical.status}"></td>
                                <td th:text="${technical.technical.fullName}"></td>
                                <td>
                                    <a th:href="@{/technical/add/{id}(id=${technical.technical.userId})}"
                                       class="btn btn-primary btn-xs">
                                        <i class="fa fa-folder"></i> View
                                    </a>
                                </td>
                            </tr>
                            </tbody>

                        </table>


                        <div class="form-container" th:unless="${roleName == 'ADMIN'}">
                            <a>Export excel by repair date:</a>
                            <form th:action="@{/technical/export/excel}" method="get">
                                <input type="text" id="repairDate" name="repairDate" class="form-control"
                                       placeholder="Choose date: ..." onchange="this.form.submit()">
                            </form>
                        </div>

                        <div id="errorModal" class="modal">
                            <div class="modal-content">
                                <span id="closeErrorModalBtn" class="close">&times;</span>
                                <p id="errorMessage"></p>
                            </div>
                        </div>

                        <div class="container">
                            <div class="row justify-content-between align-items-center">
                                <div class="col-auto">
                                    <div class="d-flex align-items-center">
                                        <a class="media-body">Number of records </a>
                                        <form th:action="@{/technical/warranties}" method="get">
                                            <select name="pageSize" class="form-select"
                                                    onchange="this.form.submit()">
                                                <option th:value="5" th:selected="${size == 5}">5</option>
                                                <option th:value="10" th:selected="${size == 10}">10</option>
                                                <option th:value="15" th:selected="${size == 15}">15</option>
                                            </select>
                                            <!--                                            <input type="hidden" th:name="page" th:value="${warrantyPage.number}"/>-->
                                            <!--                                            <input type="hidden" th:name="query" th:value="${query}"/>-->
                                            <!--                                            <input type="hidden" th:name="role" th:value="${role}"/>-->
                                        </form>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <nav aria-label="Page navigation">
                                        <ul class="pagination justify-content-end mb-0">
                                            <li class="page-item"
                                                th:classappend="${warrantyPage.number == 0} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/technical/warranties(size=${warrantyPage.size}, page=${warrantyPage.number - 1})}">Previous</a>
                                            </li>
                                            <li th:each="pageNumber : ${pageNumbers}" th:class="page-item"
                                                th:classappend="${pageNumber == warrantyPage.number + 1} ? 'active'">
                                                <a class="page-link"
                                                   th:href="@{/technical/warranties(size=${warrantyPage.size}, page=${pageNumber - 1})}"
                                                   th:text="${pageNumber}"></a>
                                            </li>
                                            <li class="page-item"
                                                th:classappend="${warrantyPage.number + 1 == warrantyPage.totalPages} ? 'disabled'">
                                                <a class="page-link"
                                                   th:href="@{/technical/warranties(size=${warrantyPage.size}, page=${warrantyPage.number + 1})}">Next</a>
                                            </li>
                                        </ul>
                                    </nav>

                                </div>
                            </div>
                        </div>
                        <script th:src="@{/vendors/jquery/dist/jquery.min.js}"></script>
                        <script th:src="@{/vendors/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
                        <script th:src="@{/vendors/fastclick/lib/fastclick.js}"></script>
                        <script th:src="@{/vendors/nprogress/nprogress.js}"></script>
                        <script th:src="@{/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js}"></script>
                        <script th:src="@{/build/js/custom.min.js}"></script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        flatpickr("#repairDate", {
            dateFormat: "Y-m-d",
            defaultDate: null,
            placeholder: "Choose date",
            onChange: function(selectedDates, dateStr, instance) {
                instance.input.form.submit();
            }
        });
    });
</script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var errorModal = document.getElementById("errorModal");
    var closeErrorModalBtn = document.getElementById("closeErrorModalBtn");

    closeErrorModalBtn.onclick = function () {
        errorModal.style.display = "none";
    }

    window.onclick = function (event) {
        if (event.target == errorModal) {
            errorModal.style.display = "none";
        }
    }

    function showErrorModal(message) {
        document.getElementById("errorMessage").innerText = message;
        errorModal.style.display = "block";
    }

    var errorMessage = /*[[${errorMessage}]]*/ 'null';
    if (errorMessage !== 'null' && errorMessage.trim() !== '') {
        showErrorModal(errorMessage);
    }
    /*]]>*/
</script>
</body>
</html>